# PDF Logo 自動插入工具 - 產品需求文件 (PRD)

## 文件資訊
- **產品名稱**: PDF Logo 自動插入工具
- **版本**: v1.0
- **最後更新**: 2026-01-25
- **專案代號**: AuraPDF

---

## 1. 產品概述

### 1.1 產品目標
開發一個網頁應用程式,讓使用者能夠上傳 PDF 檔案和公司 Logo,系統自動在每一頁的合適位置插入 Logo,並提供預覽和手動調整功能。

### 1.2 目標使用者
- 需要批量為文件添加公司 Logo 的企業用戶
- 需要為報告、簡報、合約等文件統一加上品牌識別的專業人士
- 需要快速處理大量 PDF 文件的行政人員

### 1.3 核心價值
- 自動化處理,節省手動編輯時間
- 智能識別空白位置,確保不遮擋原有內容
- 批量處理多頁 PDF,提高工作效率

---

## 2. 功能需求

### 2.1 檔案上傳功能

#### 2.1.1 PDF 檔案上傳
- **需求描述**: 使用者可上傳需要添加 Logo 的 PDF 檔案
- **支援格式**: .pdf
- **檔案限制**:
  - 單檔大小上限: 20MB (建議)
  - 頁數上限: 100 頁 (建議)
- **上傳方式**:
  - 點擊按鈕選擇檔案
  - 拖拽檔案到指定區域
- **驗證規則**:
  - 檔案格式必須為 PDF
  - 檔案不可損壞或加密

#### 2.1.2 Logo 圖片上傳
- **需求描述**: 使用者可上傳公司 Logo 圖片
- **支援格式**: PNG, JPG, JPEG, SVG
- **檔案限制**:
  - 單檔大小上限: 5MB (建議)
  - 建議尺寸: 500x500px 以上
- **上傳方式**:
  - 點擊按鈕選擇檔案
  - 拖拽檔案到指定區域
- **優先支援**:
  - PNG 格式(支援透明背景)
  - 高解析度圖片以確保清晰度

### 2.2 Logo 設定功能

#### 2.2.1 Logo 大小設定
- **設定方式**: 固定大小(像素)
- **預設值**: 80px
- **調整範圍**: 40px - 150px
- **調整介面**: 滑桿控制
- **顯示方式**: 即時顯示當前數值

#### 2.2.2 Logo 位置偏好設定
- **預設偏好**: 右下角
- **備選方案**: 系統自動尋找其他合適位置
- **位置順序**:
  1. 右下角
  2. 右上角
  3. 左下角
  4. 左上角
  5. 其他空白區域

### 2.3 空白位置檢測功能

#### 2.3.1 檢測邏輯
- **主要檢測標準**:
  - 優先檢測完全空白區域(純白色或接近白色)
  - 若無完全空白,接受淺色背景區域
- **空白判定標準**:
  - 像素顏色 RGB 值 > (240, 240, 240) 視為空白
  - 像素顏色 RGB 值 > (220, 220, 220) 視為淺色可接受
- **區域大小要求**:
  - Logo 所需區域需完全符合空白標準
  - Logo 周圍需有安全邊距(建議 10-15px)

#### 2.3.2 檢測流程
1. 將 PDF 每一頁轉換為 Canvas
2. 按位置優先順序檢測各區域
3. 分析該區域的像素資料
4. 判定是否為合適的放置位置
5. 標記檢測結果(完全空白/淺色背景/不適合)

#### 2.3.3 邊界情況處理
- **找不到合適位置時**:
  - 系統標記該頁為"需要使用者確認"
  - 在預覽畫面以黃色警告框顯示
  - 使用者可選擇跳過該頁或手動指定位置

### 2.4 預覽與調整功能

#### 2.4.1 預覽顯示
- **顯示內容**:
  - 所有 PDF 頁面的縮圖預覽
  - Logo 在每一頁的位置標示
  - 頁碼標示
- **視覺標示**:
  - 綠色框: 找到完全空白位置 ✓
  - 黃色框: 位置可能有淡色內容,需確認 ⚠
  - 紅色框: 未找到合適位置 ✗
- **排列方式**:
  - 網格式排列
  - 響應式設計(手機/平板/電腦適配)
  - 每頁顯示 Logo 放置位置的視覺指示

#### 2.4.2 手動調整功能
- **調整方式**:
  - 點擊頁面進入單頁編輯模式
  - 拖拽 Logo 到任意位置
  - 即時預覽調整效果
- **調整限制**:
  - Logo 不可超出頁面邊界
  - 保持 Logo 原始比例
- **批量操作**:
  - "應用到所有頁面"按鈕
  - "應用到相似頁面"按鈕(未來功能)

### 2.5 PDF 處理與輸出功能

#### 2.5.1 PDF 處理
- **處理方式**:
  - 使用 pdf-lib 庫修改原始 PDF
  - 在指定位置插入 Logo 圖片
  - 保持原 PDF 的其他屬性(書籤、註解等)
- **處理規則**:
  - 每一頁都需要添加 Logo
  - Logo 放置在所有原有內容之上(最上層)
  - 保持 Logo 清晰度(使用原始圖片解析度)

#### 2.5.2 輸出功能
- **輸出方式**: 直接下載處理後的 PDF
- **檔案命名**:
  - 格式: `原檔名_with_logo.pdf`
  - 範例: `報價單_with_logo.pdf`
- **輸出品質**:
  - 保持原 PDF 解析度
  - Logo 使用高品質嵌入
  - 檔案大小優化

---

## 3. 使用者流程

### 3.1 主流程

```
開始
  ↓
步驟 1: 上傳檔案
  - 上傳 PDF 檔案
  - 上傳 Logo 圖片
  - 設定 Logo 大小
  ↓
步驟 2: 自動分析
  - 系統分析每一頁
  - 自動尋找合適位置
  - 生成預覽
  ↓
步驟 3: 預覽與調整
  - 檢視所有頁面預覽
  - 手動調整不滿意的位置
  - 確認所有頁面
  ↓
步驟 4: 下載結果
  - 系統處理 PDF
  - 下載處理後的檔案
  ↓
完成
```

### 3.2 異常流程

#### 3.2.1 找不到合適位置

```
系統檢測失敗
  ↓
在預覽頁面標記為黃色/紅色
  ↓
使用者選擇:
  - 手動調整位置
  - 跳過該頁(不添加 Logo)
  - 使用系統建議的次優位置
```

#### 3.2.2 檔案格式錯誤

```
上傳不支援的檔案
  ↓
顯示錯誤訊息
  ↓
要求重新上傳正確格式
```

---

## 4. 技術規格

### 4.1 前端技術棧
- **框架**: React + TypeScript
- **建構工具**: Vite
- **樣式**: Tailwind CSS
- **圖標**: Lucide React

### 4.2 核心函式庫
- **PDF.js**: PDF 檔案讀取和渲染
  - 版本: 3.x 或以上
  - 用途: 將 PDF 頁面轉換為 Canvas 進行分析
- **pdf-lib**: PDF 檔案修改
  - 版本: 1.17.x 或以上
  - 用途: 在 PDF 中插入圖片並生成新檔案
- **Canvas API**: 圖片處理和像素分析
  - 用途: 分析頁面空白區域

### 4.3 空白檢測演算法

#### 4.3.1 像素分析演算法

```javascript
function detectBlankArea(canvas, x, y, width, height) {
  const ctx = canvas.getContext('2d');
  const imageData = ctx.getImageData(x, y, width, height);
  const pixels = imageData.data;
  
  let whitePixels = 0;
  let lightPixels = 0;
  const totalPixels = (width * height);
  
  for (let i = 0; i < pixels.length; i += 4) {
    const r = pixels[i];
    const g = pixels[i + 1];
    const b = pixels[i + 2];
    
    // 完全空白判定
    if (r > 240 && g > 240 && b > 240) {
      whitePixels++;
    }
    // 淺色背景判定
    else if (r > 220 && g > 220 && b > 220) {
      lightPixels++;
    }
  }
  
  const whiteRatio = whitePixels / totalPixels;
  const lightRatio = (whitePixels + lightPixels) / totalPixels;
  
  if (whiteRatio > 0.95) return 'blank'; // 完全空白
  if (lightRatio > 0.90) return 'light'; // 淺色可接受
  return 'occupied'; // 有內容
}
```

#### 4.3.2 位置檢測順序

```javascript
const positionPriority = [
  { name: 'right-bottom', x: 0.75, y: 0.85 },
  { name: 'right-top', x: 0.75, y: 0.05 },
  { name: 'left-bottom', x: 0.05, y: 0.85 },
  { name: 'left-top', x: 0.05, y: 0.05 },
  // 可擴展更多位置
];
```

### 4.4 效能要求
- **頁面載入時間**: < 2 秒
- **PDF 分析時間**:
  - 單頁 < 1 秒
  - 10 頁 < 5 秒
  - 50 頁 < 20 秒
- **PDF 生成時間**:
  - 10 頁 < 3 秒
  - 50 頁 < 10 秒

### 4.5 瀏覽器相容性
- **支援瀏覽器**:
  - Chrome 90+
  - Firefox 88+
  - Safari 14+
  - Edge 90+
- **不支援**: IE 11 及以下

---

## 5. UI/UX 設計規範

### 5.1 設計原則
- **簡潔明瞭**: 三步驟完成所有操作
- **視覺化回饋**: 即時顯示處理進度和結果
- **容錯設計**: 清楚標示問題並提供解決方案
- **響應式設計**: 支援各種螢幕尺寸

### 5.2 色彩規範
- **主色調**: 藍色 (#2563eb)
- **成功狀態**: 綠色 (#059669)
- **警告狀態**: 黃色 (#d97706)
- **錯誤狀態**: 紅色 (#dc2626)
- **中性色**: 灰色系列

### 5.3 互動設計
- **拖拽上傳**: 支援拖拽檔案到上傳區域
- **即時預覽**: 調整設定時即時更新預覽
- **載入動畫**: 處理過程中顯示進度指示
- **錯誤提示**: 清楚的錯誤訊息和修正建議

---

## 6. 測試計畫

### 6.1 功能測試
- [ ] PDF 檔案上傳和驗證
- [ ] Logo 圖片上傳和驗證
- [ ] Logo 大小調整功能
- [ ] 空白位置自動檢測
- [ ] 預覽顯示正確性
- [ ] 手動位置調整
- [ ] PDF 生成和下載
- [ ] 各種檔案格式相容性

### 6.2 效能測試
- [ ] 不同頁數 PDF 的處理速度
- [ ] 不同大小 Logo 的處理效能
- [ ] 記憶體使用情況
- [ ] 大檔案處理穩定性

### 6.3 相容性測試
- [ ] 各主流瀏覽器測試
- [ ] 不同作業系統測試
- [ ] 行動裝置測試
- [ ] 不同 PDF 版本相容性

### 6.4 邊界案例測試
- [ ] 全黑背景 PDF
- [ ] 滿版內容無空白
- [ ] 加密或受保護的 PDF
- [ ] 損壞的 PDF 檔案
- [ ] 極大/極小的 Logo 圖片
- [ ] 超大頁數 PDF (100+ 頁)

---

## 7. 限制與約束

### 7.1 技術限制
- 瀏覽器環境限制,無法處理受密碼保護的 PDF
- 處理速度受使用者裝置效能影響
- 記憶體限制,超大 PDF 可能導致處理失敗

### 7.2 功能限制
- Logo 固定大小,無法自適應頁面尺寸
- 無法識別圖片內容,只能基於像素顏色判斷空白
- 無法處理複雜的頁面佈局(如多欄位、斜向排版)

### 7.3 安全性考量
- 所有處理在客戶端進行,不上傳到伺服器
- 不儲存使用者上傳的檔案
- 處理完成後清除所有暫存資料

---

## 8. 未來擴展功能

### 8.1 第二期功能 (v2.0)
- [x] 批量處理多個 PDF 檔案 ✅ (已於 v1.1 實現)
- [x] Logo 自適應大小(根據頁面尺寸) ✅ (已於 v1.0 實現)
- [x] 更多位置模板選擇 ✅ (已於 v1.0 實現)
- [x] 浮水印模式(半透明 Logo) ✅ (已於 v1.0 實現)
- [x] 儲存常用設定檔 ✅ (已於 v1.0 實現)
- [x] PDF 密碼保護與權限設定 ✅ (已於 v1.2 實現)
- [ ] 支援多個 Logo 輪流使用

### 8.2 第三期功能 (v3.0)
- [ ] AI 智能識別最佳位置
- [ ] OCR 文字識別避免遮擋
- [ ] 雲端儲存和分享
- [ ] 團隊協作功能
- [ ] API 介面提供
- [ ] 排程自動處理

---

## 9. 成功指標

### 9.1 產品指標
- 使用者完成率 > 80%
- 平均處理時間 < 1 分鐘 (10 頁 PDF)
- 錯誤率 < 5%
- 使用者滿意度 > 4/5

### 9.2 技術指標
- 頁面載入時間 < 2 秒
- 處理成功率 > 95%
- 瀏覽器崩潰率 < 1%
- API 回應時間 < 500ms (未來功能)

---

## 10. 附錄

### 10.1 參考資料
- PDF.js 官方文件: https://mozilla.github.io/pdf.js/
- pdf-lib 官方文件: https://pdf-lib.js.org/
- Canvas API 文件: https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API

### 10.2 版本歷史
- v1.2 (2026-01-28): 新增 PDF 密碼保護與權限設定功能
- v1.1 (2026-01-25): 新增批量處理功能
- v1.0 (2026-01-25): 初版 PRD 完成

### 10.3 詞彙表
- **PDF**: Portable Document Format,可攜式文件格式
- **Logo**: 商標、標誌
- **Canvas**: HTML5 畫布元素
- **像素分析**: 分析圖片每個像素點的顏色資訊
- **RGB**: 紅綠藍三原色色彩模式
